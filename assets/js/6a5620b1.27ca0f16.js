"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[63],{2510:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var t=a(3117),r=(a(7294),a(3905));const i={sidebar_position:2},o="Creaci\xf3n de instancias QMAP",p={unversionedId:"create-instance",id:"create-instance",title:"Creaci\xf3n de instancias QMAP",description:"qmapCreator recibe opcionalmente un objeto que permite extender",source:"@site/docs/create-instance.md",sourceDirName:".",slug:"/create-instance",permalink:"/qmap/docs/create-instance",draft:!1,editUrl:"https://github.com/gbenm/qmap/tree/main/docs/docs/create-instance.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Intro",permalink:"/qmap/docs/intro"},next:{title:"La instancia",permalink:"/qmap/docs/instance"}},s={},l=[{value:"Opciones",id:"opciones",level:2},{value:"<code>functions</code>",id:"functions",level:3},{value:"<code>schemas</code>",id:"schemas",level:3},{value:"<code>queries</code>",id:"queries",level:3},{value:"<code>extends</code>",id:"extends",level:3},{value:"<code>mode</code>",id:"mode",level:3},{value:"<code>cache</code>",id:"cache",level:3}],c={toc:l};function m(e){let{components:n,...a}=e;return(0,r.kt)("wrapper",(0,t.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"creaci\xf3n-de-instancias-qmap"},"Creaci\xf3n de instancias QMAP"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"qmapCreator")," recibe opcionalmente un objeto que permite extender\nlas capacidades de la instancia."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmap = qmapCreator({\n    extends: undefined,\n    functions: undefined,\n    schemas: undefined,\n    queries: undefined,\n    cache: undefined,\n    mode: undefined\n})\n')),(0,r.kt)("h2",{id:"opciones"},"Opciones"),(0,r.kt)("h3",{id:"functions"},(0,r.kt)("inlineCode",{parentName:"h3"},"functions")),(0,r.kt)("p",null,"Aqu\xed es d\xf3nde se declaran las funciones que tiene disponible la\nquery."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmap = qmapCreator({\n    functions: {\n        upperCase: (str) => str.toUpperCase()\n    }\n})\n')),(0,r.kt)("p",null,"Luego se puede utilizar de la siguiente forma:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    upperCase(name)\n}`\n")),(0,r.kt)("admonition",{title:"Funci\xf3n no declarada",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Si no se declara la funci\xf3n, ser\xe1 un error en runtime\npara su aplicaci\xf3n (a menos que est\xe9 declarada en alg\xfan padre\nal hacer uso de ",(0,r.kt)("a",{parentName:"p",href:"#extends"},"extends"),")")),(0,r.kt)("h3",{id:"schemas"},(0,r.kt)("inlineCode",{parentName:"h3"},"schemas")),(0,r.kt)("p",null,"Al tener un servicio que cuenta con varios niveles de\nautorizaci\xf3n se puede incurrir en tener condicionales para\nseleccionar que datos se deben incluir seg\xfan el rol, lo que\nsignifica que si se agrega un nuevo rol habr\xe1 que cambiar\nel c\xf3digo interno del endpoint, ",(0,r.kt)("strong",{parentName:"p"},"qmap")," tiene como prop\xf3sito\nno enfocarse en que informaci\xf3n tiene que poder consultar cada\nusuario, sino en que es lo que se quiere, por lo que los\ncondicionales pueden cambiar su enfoque de ",(0,r.kt)("strong",{parentName:"p"},'"el rol tiene\nacceso a"'),", a ",(0,r.kt)("strong",{parentName:"p"},'"se van incluir en lo consultado?"'),",\nla librer\xeda se encarga de filtrar la informaci\xf3n seg\xfan lo\ndeclarado (v\xe9ase ",(0,r.kt)("a",{parentName:"p",href:"./instance/#includes"},"funci\xf3n includes"),")."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmap = qmapCreator({\n  schemas: `{\n    admin {\n      transaction, product, provider\n    },\n    client {\n      transaction {\n        description, amount, date\n      },\n      product {\n        name\n      }\n    }\n  }`\n})\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"{}")),(0,r.kt)("p",{parentName:"admonition"},"Es importante no olvidar las llaves que envuelven los ",(0,r.kt)("inlineCode",{parentName:"p"},"schemas"))),(0,r.kt)("p",null,"En este ejemplo el administrador puede consultar\ntoda la informaci\xf3n en ",(0,r.kt)("strong",{parentName:"p"},"transaction"),", ",(0,r.kt)("strong",{parentName:"p"},"product")," y ",(0,r.kt)("strong",{parentName:"p"},"provider"),"\nsin embargo, el cliente puede ver \xfanicamente ",(0,r.kt)("strong",{parentName:"p"},"transaction")," y\n",(0,r.kt)("strong",{parentName:"p"},"product"),", adem\xe1s que se le restringe que informaci\xf3n puede consultar,\n",(0,r.kt)("strong",{parentName:"p"},"transaction")," se limita a ",(0,r.kt)("strong",{parentName:"p"},"description, amount y date"),", y del ",(0,r.kt)("strong",{parentName:"p"},"product"),"\n\xfanicamente a ",(0,r.kt)("strong",{parentName:"p"},"name"),"."),(0,r.kt)("p",null,"Se puede seleccionar el ",(0,r.kt)("inlineCode",{parentName:"p"},"schema")," al compilar la query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'qmap(query, {\n    schema: "admin"\n})\n')),(0,r.kt)("p",null,"Si tiene trozos repetidos puede reutilizarlos usando ",(0,r.kt)("inlineCode",{parentName:"p"},"spread"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmap = qmapCreator({\n  schemas: `{\n    client {\n      transaction,\n      product\n    },\n    admin {\n      ...client,\n      provider\n    }\n  }`\n})\n')),(0,r.kt)("p",null,"En lo anterior el cliente tiene acceso total a ",(0,r.kt)("strong",{parentName:"p"},"transaction")," y\n",(0,r.kt)("strong",{parentName:"p"},"product"),", como el administrador tambi\xe9n los tiene simplemente\nse puede utilizar el operador ",(0,r.kt)("inlineCode",{parentName:"p"},"spread")," para copiar lo que ya se defini\xf3\nantes (debe estar declarado antes). Algo que por\nel momento no se ha mencionado, pero es importante, es que\nel ",(0,r.kt)("inlineCode",{parentName:"p"},"spread")," funciona \xfanicamente en el scope de la query (el string)\npor lo que aunque se use ",(0,r.kt)("inlineCode",{parentName:"p"},"extends")," no podr\xe1 utilizarlo con los\n",(0,r.kt)("inlineCode",{parentName:"p"},"schemas")," o ",(0,r.kt)("inlineCode",{parentName:"p"},"queries")," del qmap padre."),(0,r.kt)("h3",{id:"queries"},(0,r.kt)("inlineCode",{parentName:"h3"},"queries")),(0,r.kt)("p",null,"Permite predefinir manipulaciones del JSON que pueden ser modificadas\npor medio de la query que se manda a ejecutar."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmap = qmapCreator({\n  queries: `{\n    compact_transaction {\n      description: transaction.description,\n      amount: transaction.amount,\n    }\n  }`\n})\n')),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("mdxAdmonitionTitle",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"mdxAdmonitionTitle"},"{}")),(0,r.kt)("p",{parentName:"admonition"},"Es importante no olvidar las llaves que envuelven las ",(0,r.kt)("inlineCode",{parentName:"p"},"queries"))),(0,r.kt)("p",null,"Las queries compiladas con la funci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"qmap")," podr\xe1 hacer\nuso del nombre ",(0,r.kt)("inlineCode",{parentName:"p"},"compact_transaction")," para referirse a dicha\nquery."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'qmap("compact_transaction")\n// es equivalente\nqmap(`{\n    description: transaction.description,\n    amount: transaction.amount,\n}`)\n')),(0,r.kt)("p",null,"Para aplicar transformaciones sobre la query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"qmap(`compact_transaction {\n    description\n}`)\n")),(0,r.kt)("h3",{id:"extends"},(0,r.kt)("inlineCode",{parentName:"h3"},"extends")),(0,r.kt)("p",null,"Permite reutilizar ",(0,r.kt)("inlineCode",{parentName:"p"},"functions"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"queries")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"schemas")," de\notras instancias ya creadas. Lo definido en la instancia\nactual, sobreescribe el comportamiento de las anteriores\n(\xfanicamente para la nueva instacia)."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'import { qmapCreator } from "@qmap/engine"\n\nconst qmapCommon = qmapCreator({\n  functions: {\n    concat(...strs) {\n      return strs.join("")\n    },\n    take(list, n) {\n      return list.slice(0, n)\n    },\n    upperCase(str) {\n      return str.toUpperCase()\n    }\n  }\n})\n\nconst qmap = qmapCreator({\n  extends: qmapCommon,\n  schemas: `{\n    admin {\n      ... // puede consultar todo\n      // tambi\xe9n podr\xeda no definirlo\n    },,\n    client {\n      name,\n      price\n    }\n  }`\n})\n')),(0,r.kt)("p",null,"Por lo que lo siguiente es v\xe1lido:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"qmap(`{\n    concat(name, id)\n}`)\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"qmapCreator")," compila la query de ",(0,r.kt)("inlineCode",{parentName:"p"},"schemas")," y ",(0,r.kt)("inlineCode",{parentName:"p"},"queries"),"\nal ejecutarse (es decir que la instancia devuelta para\nejecutar queries ya no las vuelve a compilar)\npor lo que dejar la llamada a ",(0,r.kt)("inlineCode",{parentName:"p"},"qmapCreator")," en\nd\xf3nde no se vuelva a ejecutar ser\xe1 una buena elecci\xf3n.")),(0,r.kt)("h3",{id:"mode"},(0,r.kt)("inlineCode",{parentName:"h3"},"mode")),(0,r.kt)("p",null,"Se refiere a como debe operar la instancia y sus hijos (si no es sobreescrito)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"only-cache"')," al usar ",(0,r.kt)("inlineCode",{parentName:"li"},"apply")," si el valor no existe en el cache, se lanzar\xe1\nuna excepci\xf3n"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"normal"')," ",(0,r.kt)("strong",{parentName:"li"},"(por defecto)")," utiliza el cache si el valor se encuentra, en otro\ncaso compila y guarda, si existe un cache, de otro modo funciona al igual que ",(0,r.kt)("inlineCode",{parentName:"li"},"compiler")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"compiler"')," siempre compila la query")),(0,r.kt)("h3",{id:"cache"},(0,r.kt)("inlineCode",{parentName:"h3"},"cache")),(0,r.kt)("p",null,"Recibe el cache (de tipo ",(0,r.kt)("inlineCode",{parentName:"p"},"CacheStore"),") que se va utilizar en la instancia actual y sus\nhijos (si no es sobreescrito) v\xe9ase ",(0,r.kt)("a",{parentName:"p",href:"./cache"},"compiler cache")))}m.isMDXComponent=!0},3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>u});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function p(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=t.createContext({}),l=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=l(e.components);return t.createElement(s.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=l(a),u=r,k=d["".concat(s,".").concat(u)]||d[u]||m[u]||i;return a?t.createElement(k,o(o({ref:n},c),{},{components:a})):t.createElement(k,o({ref:n},c))}));function u(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p.mdxType="string"==typeof e?e:r,o[1]=p;for(var l=2;l<i;l++)o[l]=a[l];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);