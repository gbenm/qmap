"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[521],{3905:(e,n,a)=>{a.d(n,{Zo:()=>c,kt:()=>u});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function s(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=t.createContext({}),p=function(e){var n=t.useContext(l),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},c=function(e){var n=p(e.components);return t.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(a),u=r,v=m["".concat(l,".").concat(u)]||m[u]||d[u]||i;return a?t.createElement(v,o(o({ref:n},c),{},{components:a})):t.createElement(v,o({ref:n},c))}));function u(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=a[p];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},2850:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var t=a(7462),r=(a(7294),a(3905));const i={sidebar_position:4},o="Funciones",s={unversionedId:"queries/functions",id:"queries/functions",title:"Funciones",description:"Debe declararlas en el qmapCreator, luego de esto",source:"@site/docs/queries/functions.md",sourceDirName:"queries",slug:"/queries/functions",permalink:"/qmap/docs/queries/functions",draft:!1,editUrl:"https://github.com/gbenm/qmap/tree/main/docs/docs/queries/functions.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Index select",permalink:"/qmap/docs/queries/index-select"},next:{title:"On Result",permalink:"/qmap/docs/queries/onresult"}},l={},p=[{value:"En general",id:"en-general",level:2},{value:"Retorno de la funci\xf3n",id:"retorno-de-la-funci\xf3n",level:2},{value:"Optimizaci\xf3n",id:"optimizaci\xf3n",level:3},{value:"Est\xe9tico",id:"est\xe9tico",level:3},{value:"Forzar modificaci\xf3n del \xedndice",id:"forzar-modificaci\xf3n-del-\xedndice",level:3},{value:"Funciones map",id:"funciones-map",level:2}],c={toc:p};function d(e){let{components:n,...a}=e;return(0,r.kt)("wrapper",(0,t.Z)({},c,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"funciones"},"Funciones"),(0,r.kt)("p",null,"Debe declararlas en el ",(0,r.kt)("inlineCode",{parentName:"p"},"qmapCreator"),", luego de esto\npuede utilizar el nombre de la funci\xf3n dentro de la query,\ndebe ser un identificador v\xe1lido, no es permitido utilizar\n",(0,r.kt)("inlineCode",{parentName:"p"},'""')," para el nombre de las funciones."),(0,r.kt)("h2",{id:"en-general"},"En general"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"El nombre que toma la key en el resultado, es la concatenaci\xf3n de los\nargumentos.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Las funciones se aplican sobre los valores en el JSON de entrada\n(no sobre los valores incluidos en el resultado)."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    toString(id)\n}`\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Se pueden componer"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    upperCase(fullname(first_name, last_name)),\n}`\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pueden utilizar variables (no es permitido utilizar ",(0,r.kt)("inlineCode",{parentName:"p"},'""')," para el nombre\nde variables) estas se mandan atrav\xe9s de ",(0,r.kt)("inlineCode",{parentName:"p"},"qmap")," o ",(0,r.kt)("inlineCode",{parentName:"p"},"apply")),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const query = `{\n    take(members, @quantity)\n}`\n\nqmap(query, {\n    variables: {\n        quantity: 5\n    }\n})\n")))),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Las variables se declaran con un ",(0,r.kt)("inlineCode",{parentName:"p"},"@")," al inicio, seguido de un identificador.\n",(0,r.kt)("strong",{parentName:"p"},"No")," puede usar comillas ",(0,r.kt)("inlineCode",{parentName:"p"},'""')))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Puede utilizar n\xfameros, strings y booleans utilizando la notaci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"@{*}"),"\n(\xfanicamente es v\xe1lido para las funciones)."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'const query = `{\n    take(members, @{3}),\n    parents: filterBy(members, @{"isParent"}, @{true})\n}`\n\nqmap(query)\n'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pueden usarse dentro de la selecci\xf3n, sin embargo esto limita la informaci\xf3n\nque puede utilizar a la que existe dentro de la clave en el JSON\nde entrada. Tambi\xe9n es permitido utilizar ",(0,r.kt)("strong",{parentName:"p"},"selecci\xf3n")," y\n",(0,r.kt)("strong",{parentName:"p"},"acceso")," como argumentos."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    product {\n        upperCase(provider.name)\n    },\n    transaction {\n        calcTotal(products {\n            price\n        })\n    }\n}`\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Queda en responsabilidad del desarrollador controlar\nerrores en las funciones, ya que la funci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"apply")," podr\xeda\nfallar, tambi\xe9n se debe tener en cuenta que los argumentos\npueden ser ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"No se transforma la salida de la funci\xf3n, es decir que\npuede devolver ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," si lo desea.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Las funciones deben ser s\xedncronas, pero podr\xeda ser \xfatil\nposteriormente agregar as\xedncronas."))),(0,r.kt)("h2",{id:"retorno-de-la-funci\xf3n"},"Retorno de la funci\xf3n"),(0,r.kt)("p",null,"Se puede modificar el retorno de una funci\xf3n. Puede ser\nde \xfatilidad cu\xe1ndo tiene un enfoque de optimizaci\xf3n o\nest\xe9tico."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Las modificaciones al retorno de la funci\xf3n no\nafecta el ",(0,r.kt)("a",{parentName:"p",href:"../instance#includes"},"\xedndice"),"."))),(0,r.kt)("h3",{id:"optimizaci\xf3n"},"Optimizaci\xf3n"),(0,r.kt)("p",null,"Al ejecutar un select sobre un array este se aplica por\ncada elemento, por ejemplo si la funci\xf3n tiene el prop\xf3sito\nde reducir la cantidad de elementos"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"function execute(query) {\n    const { apply } = qmap(query)\n\n    apply(input)\n}\n\nexecute(`{\n    take(products { name }, @{10})\n}`) // 214.7 ms en promedio (300,000 items)\n\n// vs\n\nexecute(`{\n    take(products, @{10}) { name }\n}`) // 0.1 ms en promedio (300,000 items)\n")),(0,r.kt)("p",null,'Esto sucede porque no es lo mismo seleccionar el "name" de 300,000\nitems y tomar 10 a tomar 10 de 300,000 y seleccionar s\xf3lo el "name".'),(0,r.kt)("h3",{id:"est\xe9tico"},"Est\xe9tico"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    take(products { name, provider { name } }, @{10})\n}`\n\n// vs\n\nconst query2 = `{\n    take(products, @{10}) {\n        name,\n        provider {\n            name\n        }\n    }\n}`\n")),(0,r.kt)("h3",{id:"forzar-modificaci\xf3n-del-\xedndice"},"Forzar modificaci\xf3n del \xedndice"),(0,r.kt)("p",null,"El problema radica en que las operaciones sobre el retorno de\nla funci\xf3n no afectan el ",(0,r.kt)("a",{parentName:"p",href:"../instance#includes"},"\xedndice")," (el que le\npermite saber si se debe incluir la informaci\xf3n), por lo que resulta\nincluyendo todo."),(0,r.kt)("p",null,"Para poder evitar incluir todo en el \xedndice se puede utilizar ",(0,r.kt)("a",{parentName:"p",href:"./index-select"},"index select"),",\nlo que permite conservar a\xfan la optimizaci\xf3n."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    products: take(products #{ name }, @{2}) {\n        name\n    }\n}`\n")),(0,r.kt)("p",null,"Se puede volver m\xe1s legible utilizando ",(0,r.kt)("a",{parentName:"p",href:"./onresult"},"on result")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    producs #{ name },\n    products: take(%{products}, @{2}) {\n        !provider\n        name\n    }\n}`\n")),(0,r.kt)("p",null,'En el ejemplo anterior no fue necesario remover\nel "extra" ya que al renombrar el resultado\nde ',(0,r.kt)("inlineCode",{parentName:"p"},"take")," se est\xe1 sobreescribiendo, si se agrega informaci\xf3n\ntemporal que no ser\xe1 sobreescrita, podr\xeda ser una opci\xf3n\nutilizar ",(0,r.kt)("a",{parentName:"p",href:"./exclude"},"exclude")," para removerlo."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    temp: producs #{ name },\n    take(%{products}, @{2}) #{\n        !provider\n        name\n    },\n    !temp // eliminado despu\xe9s del uso\n}`\n")),(0,r.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Esto \xfanicamente tiene sentido si se va utilizar el \xedndice de esta selecci\xf3n para\nrealizar una operaci\xf3n condicional, por ejemplo ",(0,r.kt)("inlineCode",{parentName:"p"},"provider")," podr\xeda significar\nun join con la tabla de Proveedores si es que se usa una RDB"))),(0,r.kt)("h2",{id:"funciones-map"},"Funciones map"),(0,r.kt)("p",null,"Por defecto las funciones toman el objeto, es decir\nque se ejecutar\xeda una sola vez y como argumento tendr\xeda el array,\npara ejecutar la funci\xf3n por cada elemento debe llamar\nsu funci\xf3n de esta manera:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    upperCase(@[products.name])\n}`\n\nconst input = {\n  products: [\n    { name: \"pencil\" },\n    { name: \"paper\" },\n  ],\n}\n\nconst result = {\n  products_name: [ 'PENCIL', 'PAPER' ]\n}\n")),(0,r.kt)("p",null,"Al encerrar el argumento que es el array en ",(0,r.kt)("inlineCode",{parentName:"p"},"@[]")," se indica\nque se debe aplicar a cada elemento (s\xf3lo puede haber uno de estos)."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Los dem\xe1s argumentos deben ser valores globales, es decir,\nque est\xe9n en el scope de la clave en el JSON de entrada\no bien ser variables. Aunque los dem\xe1s valores sean\narreglos ser\xe1n tratados como argumentos \xfanicos"))),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Puede utilizar la composici\xf3n (se pueden componer funciones\npor elemento y normales):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    take(currency(@[ add(@[ids], offset) ]), @quantity)\n}`\n\nconst input = {\n    offset: 100,\n    ids: [1, 2, 3, 4, 5],\n}\n\nconst result = {\n  ids_offset_quantity: [ '$101.00', '$102.00', '$103.00' ]\n}\n")),(0,r.kt)("p",null,"Alternativamente se puede encerrar la funci\xf3n en ",(0,r.kt)("inlineCode",{parentName:"p"},"[]")," para indicar\nque es una funci\xf3n map."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const query = `{\n    [ upperCase(products.name) ]\n}`\n\nconst input = {\n  products: [\n    { name: \"pencil\" },\n    { name: \"paper\" },\n  ],\n}\n\nconst result = {\n  products_name: [ 'PENCIL', 'PAPER' ]\n}\n")),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Con la notaci\xf3n ",(0,r.kt)("inlineCode",{parentName:"p"},"[]")," se asume que el primer argumento es\nel array."))))}d.isMDXComponent=!0}}]);